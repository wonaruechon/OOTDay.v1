# Story 1.5: Update Outfit Suggestions to Use Product Catalog - Brownfield Addition

## Status
Ready for Review

## Story

**As a** user seeking fashion recommendations,
**I want** outfit suggestions to use real products from the Central Group catalog,
**so that** I can purchase the exact items shown in the recommended outfits.

## Story Context

**Existing System Integration:**
- Integrates with: Outfit recommendation logic in `lib/mock-data.ts`, Product catalog from CSV
- Technology: Next.js, TypeScript, outfit generation algorithm
- Follows pattern: Existing `mockOutfits` structure with real catalog products
- Touch points: Outfit data generation, chat AI response, outfit display components

## Acceptance Criteria

**Functional Requirements:**
1. Outfit suggestions use products from real product catalog (Product_Men.csv, Product_Woman.csv)
2. Outfits are gender-appropriate based on user query context
3. Outfit suggestions include 2-5 coordinated products per outfit

**Integration Requirements:**
4. Existing Outfit interface remains unchanged
5. Outfit generation logic replaces mock products with catalog products
6. AI chat responses continue to work with new outfit data

**Quality Requirements:**
7. Outfit product combinations are fashion-appropriate (e.g., tops + bottoms + shoes)
8. Price calculation reflects real product prices from catalog
9. At least 3-5 diverse outfit options available for common queries

## Technical Notes

- **Integration Approach:**
  - Create `lib/outfit-generator.ts` utility to generate outfits from product catalog
  - Implement basic outfit composition logic (categorize products by type, combine appropriately)
  - Update `getMockOutfitResponse()` in mock-data.ts to use catalog-based outfits
- **Existing Pattern Reference:**
  - Current `mockOutfits` structure in `lib/mock-data.ts` lines 102-143
  - Outfit interface: `{ id, title, description, totalPrice, items: Product[], imageUrl }`
- **Key Constraints:**
  - Products categorized by type (tops, bottoms, shoes, accessories) for proper outfit composition
  - Gender-specific outfit generation (men's products for men's queries, women's for women's)
  - Outfit price range should be reasonable and varied (e.g., ฿2,000 - ฿10,000)

## Tasks / Subtasks

- [x] Create outfit generation utility (AC: 1, 3, 7)
  - [x] Create `lib/outfit-generator.ts` file
  - [x] Implement product categorization function (tops, bottoms, shoes, accessories)
  - [x] Implement `generateOutfit(products, gender?, style?)` function
  - [x] Logic to combine 2-5 products into coordinated outfit
  - [x] Generate outfit title and description based on products
- [x] Implement gender-specific outfit logic (AC: 2)
  - [x] Filter products by gender/category before generating outfits
  - [x] Create `generateMensOutfits(products)` helper
  - [x] Create `generateWomensOutfits(products)` helper
  - [x] Handle unisex or mixed queries appropriately
- [x] Update outfit response logic (AC: 4, 6, 9)
  - [x] Update `getMockOutfitResponse()` in mock-data.ts
  - [x] Replace hardcoded `mockOutfits` with generated outfits
  - [x] Generate 3-5 diverse outfit options per query
  - [x] Maintain existing Outfit interface structure
  - [x] Calculate accurate `totalPrice` from product prices (AC: 8)
- [x] Testing and validation
  - [x] Test men's outfit generation with Product_Men.csv
  - [x] Test women's outfit generation with Product_Woman.csv
  - [x] Verify outfit combinations are fashion-appropriate
  - [x] Test various query types (business, casual, formal, etc.)
  - [x] Verify price calculations are accurate
  - [x] Test edge cases (insufficient products, single category, etc.)

## Dev Notes

**Relevant Source Tree:**
- `frontend/lib/mock-data.ts` - Contains `mockOutfits` and `getMockOutfitResponse()` to update
- `frontend/lib/types.ts` - Outfit and Product interfaces
- `frontend/lib/product-loader.ts` - CSV parser with product catalog (created in Story 1.1)
- `docs/Product_Men.csv` - Men's product catalog
- `docs/Product_Woman.csv` - Women's product catalog

**Outfit Interface (from types.ts):**
```typescript
interface Outfit {
  id: string
  title: string
  description: string
  totalPrice: number
  items: Product[]
  imageUrl?: string
}
```

**Product Categorization Strategy:**
- Parse product name/description to identify type:
  - Tops: shirt, blouse, t-shirt, top, blazer, jacket
  - Bottoms: trousers, pants, jeans, shorts, skirt
  - Shoes: shoes, boots, sneakers, sandals
  - Accessories: bag, belt, watch, sunglasses
  - Dresses: dress (standalone outfit item for women)
- Use Sub-Category field from CSV if available

**Outfit Generation Algorithm (Basic):**
```typescript
function generateOutfit(products: Product[], gender?: string): Outfit {
  const categorized = categorizeProducts(products)

  // Example: Business outfit = top + bottom + shoes
  const top = randomPick(categorized.tops)
  const bottom = randomPick(categorized.bottoms)
  const shoes = randomPick(categorized.shoes)

  const items = [top, bottom, shoes].filter(Boolean)
  const totalPrice = items.reduce((sum, p) => sum + p.price, 0)

  return {
    id: `outfit-${Date.now()}`,
    title: generateOutfitTitle(items),
    description: generateOutfitDescription(items),
    totalPrice,
    items,
    imageUrl: items[0]?.imageUrl // Use first item's image as outfit image
  }
}
```

**Integration with Chat Response:**
- Update `getMockOutfitResponse()` to generate fresh outfits from catalog
- Match query keywords (business, casual, formal) to outfit style
- Generate gender-appropriate outfits based on query context

### Testing

**Testing Standards:**
- Test file location: `frontend/lib/__tests__/outfit-generator.test.ts`
- Testing framework: Jest
- Test requirements:
  - Unit test product categorization function
  - Unit test `generateOutfit()` with various product sets
  - Unit test gender-specific outfit generation
  - Test outfit price calculation accuracy
  - Test outfit title/description generation
  - Integration test with real CSV data
  - Test edge cases (empty product list, single product, etc.)

## Risk and Compatibility

**Minimal Risk Assessment:**
- **Primary Risk:** Outfit combinations may not be fashion-appropriate; insufficient product variety in catalog
- **Mitigation:**
  - Implement basic fashion rules (e.g., don't combine two tops)
  - Start with simple outfit templates (top+bottom+shoes)
  - Fallback to showing individual products if outfit generation fails
  - Can enhance with AI-powered matching in future iterations
- **Rollback:** Revert to original `mockOutfits`; simple import swap

**Compatibility Verification:**
- [x] Outfit interface unchanged (non-breaking)
- [x] Existing components work with generated outfits
- [x] No database changes (uses CSV data)
- [x] Performance impact: outfit generation happens on-demand (minimal)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-03 | 1.0 | Initial story creation | Sarah (PO) |
| 2025-10-03 | 1.1 | Completed outfit generator implementation | James (Dev Agent) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
- All tests passing: 179 tests (87 foundation + 12 CSV loader + 33 ProductDetail + 40 outfit generator + 7 product utils)
- Production build successful with no TypeScript errors
- Outfit generation working with 2,636 real products from CSV catalog

### Completion Notes List
- Created comprehensive outfit-generator.ts utility module (379 lines)
- Implemented product categorization by type: tops, bottoms, shoes, dresses, accessories
- Supports both English and Thai product name categorization (เสื้อ, กางเกง, รองเท้า, etc.)
- Product categorization keywords: shirts/blouses/t-shirts (tops), pants/trousers/jeans/skirts (bottoms), shoes/boots/sneakers (shoes), dresses, bags/belts/accessories
- Implemented outfit composition strategies:
  - Women's dress-based outfits: dress + shoes + accessory
  - Traditional outfits: top + bottom + shoes + optional accessory
  - Minimum 2 items required per outfit
- Gender-specific outfit generation:
  - `filterProductsByGender()` filters products by category field (Men vs Women)
  - `generateMensOutfits()` and `generateWomensOutfits()` helper functions
  - Gender detection from query context
- Style-based outfit generation:
  - Supported styles: business, casual, formal, weekend, date, workout, any
  - Style-specific titles: "Professional Business Look", "Casual Weekend Style", "Evening Elegance", etc.
  - Style-specific descriptions matched to outfit type
- Smart query parsing in `generateOutfitsFromQuery()`:
  - Detects gender from query ("men", "women")
  - Detects style from keywords ("business", "casual", "formal", "date", "weekend", "workout")
  - Automatically generates 5 relevant outfits per query
- Advanced features:
  - Price range filtering (min/max)
  - Out-of-stock product filtering
  - Automatic total price calculation from product prices
  - Unique outfit ID generation
  - Uses first product image as outfit image
- Updated `getMockOutfitResponse()` in mock-data.ts:
  - Now calls `generateOutfitsFromQuery()` with real product catalog
  - Fallback to mock outfits if generation fails
  - Maintains existing response pattern structure
- Created comprehensive test suite: 40 tests for outfit generator (100% passing)
- Tests cover:
  - Product categorization (English and Thai)
  - Multi-product categorization
  - Gender filtering (men/women)
  - Outfit generation from categorized products
  - Total price calculation accuracy
  - Multiple outfit generation with count parameter
  - Gender-specific outfit generation
  - Out-of-stock product filtering
  - Price range filtering
  - Style-specific outfit generation
  - Query-based outfit generation (business, casual, formal, date)
  - Edge cases (empty catalog, single category, impossible price range)
  - Outfit quality validation (structure, unique IDs, image usage)
- Total test suite: 179 tests passing (100%)
- Zero breaking changes to Outfit or Product interfaces
- Outfit generation happens dynamically from real catalog data
- Performance: outfit generation is efficient, happens on-demand per query

### File List
- **Created**: `frontend/lib/outfit-generator.ts` - Outfit generation utility (379 lines)
- **Modified**: `frontend/lib/mock-data.ts` - Updated getMockOutfitResponse() to use outfit generator
- **Created**: `frontend/lib/__tests__/outfit-generator.test.ts` - Comprehensive test suite (40 tests)

## QA Results
_To be populated by QA agent_
