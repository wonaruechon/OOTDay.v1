# Story 2.1.2: Middle Panel - Outfit Discovery

**Parent Epic:** Story 2.1 Three-Panel Layout Redesign
**Phase:** 3 (Days 7-10)
**Status:** Ready for Development
**Priority:** High
**Estimated Effort:** 4 days

---

## User Story

**As a** OOTDay user,
**I want** a grid of AI-curated outfit recommendations with search and filter pills in the middle panel,
**so that** I can quickly browse complete looks for different occasions and find outfits that match my style.

---

## Acceptance Criteria

### AC1: Search Input
- [ ] Search input at top with icon (magnifying glass)
- [ ] Placeholder: "Let’s find your perfect look." (English)
- [ ] Debounced search (300ms delay)
- [ ] Updates FilterState.searchQuery
- [ ] Searches outfit titles, descriptions, and occasion tags
- [ ] Clear button (X) appears when text entered

### AC2: Filter Pills
- [ ] Horizontal scrollable pills below search
- [ ] Pills for: "Work", "Date", "Chill", "Party"
- [ ] Active pill: Purple background, white text
- [ ] Inactive pill: White background, purple border
- [ ] Click toggles filter on/off
- [ ] Syncs with left panel occasion filters

### AC3: Outfit Grid Layout
- [ ] Desktop (≥1024px): 3 columns
- [ ] Tablet (768-1023px): 2 columns
- [ ] Mobile (<768px): 2 columns
- [ ] Grid gap: 16px (gap-4)
- [ ] Responsive card sizing
- [ ] Virtualized rendering for 2,636+ outfits (react-window)

### AC4: Outfit Card Component
- [ ] Card structure:
  - Outfit preview image (3:4 aspect ratio)
  - Item count badge: "{N} items" (top-right corner)
  - Outfit title (line-clamp-1)
  - Occasion tag (small text, gray)
  - Total price (large, purple, bold)
  - "View Look" button (View Outfit)
- [ ] Hover state: Shadow lift effect
- [ ] Click anywhere on card selects outfit
- [ ] Loading state: Skeleton placeholder
- [ ] Error state: Fallback placeholder image

### AC5: Empty State
- [ ] Shows when no outfits match filters
- [ ] Icon: Sparkles or fashion-related SVG
- [ ] Title: "Your perfect outfit awaits. Refine your search."
- [ ] Description: "Let OOTDay Stylist craft your perfect look."
- [ ] Suggestion: "Clear filters" button

### AC6: Skeleton Loaders
- [ ] Skeleton cards during initial load
- [ ] Shimmer animation effect
- [ ] Match actual card dimensions
- [ ] Display 6 skeletons on desktop, 4 on mobile

### AC7: Performance
- [ ] Virtual scrolling with react-window
- [ ] Lazy load outfit images
- [ ] Render only visible cards (+buffer)
- [ ] Smooth scroll performance (60fps)
- [ ] Grid renders <300ms for 50 outfits

---

## Technical Requirements

### Component Structure
```
components/outfit/
├── OutfitDiscovery.tsx         # Main middle panel component
├── OutfitCard.tsx              # Individual outfit card (updated)
├── OutfitSearchBar.tsx         # Search input with debounce
├── FilterPills.tsx             # Horizontal filter pills
├── OutfitGrid.tsx              # Virtualized grid (updated)
├── OutfitCardSkeleton.tsx      # Loading skeleton
└── EmptyOutfitState.tsx        # No results state
```

### Virtualization Setup
```typescript
import { FixedSizeGrid as Grid } from 'react-window'

<Grid
  columnCount={3}
  columnWidth={280}
  height={window.innerHeight - 200}
  rowCount={Math.ceil(filteredOutfits.length / 3)}
  rowHeight={400}
  width={containerWidth}
>
  {({ columnIndex, rowIndex, style }) => (
    <div style={style}>
      <OutfitCard outfit={outfits[rowIndex * 3 + columnIndex]} />
    </div>
  )}
</Grid>
```

### State Management
```typescript
// lib/hooks/useOutfitFiltering.ts
export function useOutfitFiltering(
  outfits: Outfit[],
  filters: FilterState
) {
  return useMemo(() => {
    return outfits.filter(outfit => {
      // Gender filter
      if (filters.gender && filters.gender !== 'all') {
        const hasMatchingGender = outfit.items.some(
          item => item.category?.toLowerCase() === filters.gender
        )
        if (!hasMatchingGender) return false
      }

      // Occasion filter
      if (filters.occasion && filters.occasion.length > 0) {
        // Placeholder - requires outfit.style field
        // if (!filters.occasion.includes(outfit.style)) return false
      }

      // Price range filter
      if (filters.priceRange) {
        if (outfit.totalPrice < filters.priceRange.min ||
            outfit.totalPrice > filters.priceRange.max) {
          return false
        }
      }

      // Search query
      if (filters.searchQuery) {
        const query = filters.searchQuery.toLowerCase()
        const matchesTitle = outfit.title.toLowerCase().includes(query)
        const matchesDesc = outfit.description?.toLowerCase().includes(query)
        if (!matchesTitle && !matchesDesc) return false
      }

      return true
    })
  }, [outfits, filters])
}
```

---

## Design Specifications

### Layout
```
┌────────────────────────────────────────────┐
│ 🔍 Let’s find your perfect look for work, Party, Date...      │
├────────────────────────────────────────────┤
│ [Work] [Date] [Chill] [Party]   │
├────────────────────────────────────────────┤
│  ┌────────┐  ┌────────┐  ┌────────┐      │
│  │ Outfit │  │ Outfit │  │ Outfit │      │
│  │ Image  │  │ Image  │  │ Image  │      │
│  │  3:4   │  │  3:4   │  │  3:4   │      │
│  ├────────┤  ├────────┤  ├────────┤      │
│  │Title   │  │Title   │  │Title   │      │
│  │4 items  │  │3 items  │  │5 items  │      │
│  │฿3,500  │  │฿2,800  │  │฿4,200  │      │
│  │[View Look] │  │[View Look] │  │[View Look] │      │
│  └────────┘  └────────┘  └────────┘      │
│  ┌────────┐  ┌────────┐  ┌────────┐      │
│  │ ...    │  │ ...    │  │ ...    │      │
└────────────────────────────────────────────┘
```

### Styling
- Search input: `border rounded-lg px-4 py-3`
- Filter pills: `rounded-full px-4 py-2 text-sm`
- Grid gap: `gap-4`
- Card: `border rounded-lg overflow-hidden hover:shadow-lg transition-shadow`
- Image: `aspect-[3/4] w-full object-cover`
- Title: `font-medium line-clamp-1`
- Price: `text-lg font-bold text-primary`
- Button: `bg-primary text-white rounded px-4 py-2 hover:bg-primary/90`

---

## Implementation Notes

### File Changes
**New Files:**
- `components/outfit/OutfitDiscovery.tsx`
- `components/outfit/OutfitSearchBar.tsx`
- `components/outfit/FilterPills.tsx`
- `components/outfit/OutfitCardSkeleton.tsx`
- `components/outfit/EmptyOutfitState.tsx`
- `lib/hooks/useOutfitFiltering.ts`
- `lib/hooks/useDebounce.ts`

**Modified Files:**
- `components/outfit/OutfitCard.tsx` - Update for new design
- `components/outfit/OutfitGrid.tsx` - Add virtualization
- `app/page.tsx` - Import and render OutfitDiscovery in middle panel

### Debounce Hook
```typescript
// lib/hooks/useDebounce.ts
export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState(value)

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value)
    }, delay)

    return () => clearTimeout(handler)
  }, [value, delay])

  return debouncedValue
}
```

### Performance Optimization
- Use `React.memo()` for OutfitCard component
- Implement virtual scrolling with react-window
- Lazy load images with `loading="lazy"`
- Use CSS `content-visibility: auto` for off-screen cards

---

## Dependencies

**Blocked By:**
- ✅ Story 2.1 Phase 1 (Foundation) - COMPLETE
- Story 2.1.1 (Left Panel) - Filter state integration

**Blocks:**
- Story 2.1.3 (Right Panel) - Outfit selection triggers detail view
- Story 2.1.5 (Interactivity) - Grid responds to filter changes

**External Dependencies:**
- react-window library (installed in Phase 1)
- Story 1.5 (Outfit Generation) for real outfit data

---

## Testing Requirements

- [ ] Unit tests for filtering logic
- [ ] Unit tests for debounce hook
- [ ] Integration test: Search updates grid
- [ ] Integration test: Filter pills toggle correctly
- [ ] Performance test: Renders 2,000+ outfits without lag
- [ ] Visual test: Skeleton loaders match card dimensions
- [ ] Accessibility test: Keyboard navigation works
- [ ] Responsive test: Grid adapts to all breakpoints

---

## Success Metrics

- [ ] Grid renders within 300ms for 50 outfits
- [ ] Search debounce prevents excessive re-renders
- [ ] Virtual scrolling maintains 60fps scroll performance
- [ ] Empty state displays when filters return zero results
- [ ] Filter pills visually indicate active state
- [ ] All images lazy load correctly
- [ ] Zero layout shifts (CLS < 0.1)
- [ ] Lighthouse performance score ≥90

---

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Code reviewed and approved
- [ ] Unit tests written and passing (≥80% coverage)
- [ ] Performance benchmarks met
- [ ] Accessibility audit passed
- [ ] Design QA approved
- [ ] Documentation updated
- [ ] Merged to main branch
- [ ] Deployed to staging environment

---

**Created:** 2025-10-05
**Last Updated:** 2025-10-05
**Related:** Story 2.1, Story 2.1.1, Story 2.1.3, Story 1.5
