# Story 2.1.3: Right Panel - Chat Assistant + Outfit Details

**Parent Epic:** Story 2.1 Three-Panel Layout Redesign
**Phase:** 4 (Days 11-13)
**Status:** Ready for Development
**Priority:** High
**Estimated Effort:** 3 days

---

## User Story

**As a** OOTDay user,
**I want** a dual-purpose right panel that shows either the AI chat interface or detailed outfit breakdown,
**so that** I can ask the AI for outfit recommendations and view complete outfit details with individual item purchase options.

---

## Acceptance Criteria

### AC1: Dual-Purpose Panel State Management
- [ ] Right panel has two modes: `viewMode: "OOTDay Stylist" | "detail"`
- [ ] Default mode: "chat"
- [ ] Selecting an outfit from middle panel switches to "detail" mode
- [ ] "Explore more outfits" button returns to "chat" mode
- [ ] State persists during filter changes
- [ ] URL updates with selected outfit ID: `?outfit=abc123`

### AC2: Chat Interface (Default View)
- [ ] Chat header with AI avatar and name
- [ ] Message history display (user messages right-aligned, AI left-aligned)
- [ ] User messages: Purple background (#A855F7), white text
- [ ] AI messages: Light gray background, dark text
- [ ] Chat input at bottom: "เพราะทุกโอกาสคือวันสำคัญของคุณ ให้ OOTDay Stylist ช่วยเลือกลุคที่ใช่ได้เลย..." (Let OOTDay stylist help to create your perfect look)
- [ ] Send button (paper plane icon)
- [ ] Quick prompt pills:
  - "ไปทำงาน" (Go to work)
  - "เดทสุดสัปดาห์" (Weekend date)
  - "งานเลี้ยง" (Party)
  - "ชิลๆ วันหยุด" (Chill weekend)

### AC3: Outfit Detail View (Selected Outfit)
- [ ] "Explore more outfits" button at top (ghost/outline style)
- [ ] Outfit preview image (3:4 aspect ratio)
- [ ] Outfit title (h2, bold)
- [ ] Occasion tag (small, gray text)
- [ ] Product breakdown section:
  - Heading: "รายการสินค้าในชุด ({N} ชิ้น)"
  - Individual product cards for each item
- [ ] Each product shows:
  - Product image (80x80px thumbnail)
  - Product name (line-clamp-2)
  - Brand name (small, gray)
  - Price (purple, bold)
  - "ซื้อเลย" (Buy Now) button → Gender-specific Central.co.th URL

### AC4: Sticky Total Price Section
- [ ] Fixed at bottom of detail view
- [ ] White background with top border
- [ ] Total outfit price calculation
- [ ] "ซื้อทั้งชุด" (Buy All) button (large, primary)
- [ ] Visible while scrolling product list
- [ ] Smooth scroll to top when clicked

### AC5: Alternative Outfit Suggestions
- [ ] Section below product list: "ชุดอื่นที่คล้ายกัน" (Similar outfits)
- [ ] 2-column grid of outfit cards
- [ ] Mini outfit cards (smaller than main grid)
- [ ] Clicking switches to that outfit's detail view
- [ ] Shows 4-6 similar outfits based on occasion/style

### AC6: Outfit Recommendation Cards in Chat
- [ ] AI can send outfit recommendation cards embedded in messages
- [ ] Card shows:
  - Outfit preview image (smaller, 2:3 aspect ratio)
  - Outfit title
  - Item count: "{N} ชิ้น"
  - Total price
  - "ดูชุด" (View Outfit) button
- [ ] Clicking card switches to detail view for that outfit

### AC7: Accessibility & Keyboard Navigation
- [ ] ARIA label: `aria-label="แชทและรายละเอียดชุด"`
- [ ] ESC key returns from detail view to chat
- [ ] Tab navigation works through all interactive elements
- [ ] Screen reader announces mode changes
- [ ] Focus trap in chat input when typing

---

## Technical Requirements

### Component Structure
```
components/
├── chat/
│   ├── ChatAssistant.tsx            # Chat interface (updated)
│   ├── ChatHeader.tsx               # AI avatar and name
│   ├── ChatMessage.tsx              # Individual message bubble
│   ├── ChatInput.tsx                # Input field + send button
│   ├── QuickPrompts.tsx             # Quick prompt pills
│   └── OutfitRecommendationCard.tsx # Outfit card in chat
├── outfit/
│   ├── OutfitDetail.tsx             # Outfit detail view (updated)
│   ├── OutfitProductList.tsx        # Product breakdown
│   ├── ProductItemCard.tsx          # Individual product in outfit
│   ├── StickyPurchaseSection.tsx    # Sticky total + buy button
│   └── SimilarOutfits.tsx           # Alternative suggestions
└── ui/
    └── BackButton.tsx               # Reusable back button
```

### State Management
```typescript
// Right panel state in app/page.tsx
const [viewMode, setViewMode] = useState<"chat" | "detail">("chat")
const [selectedOutfit, setSelectedOutfit] = useState<Outfit | null>(null)

// Select outfit handler
const handleOutfitSelect = (outfit: Outfit) => {
  setSelectedOutfit(outfit)
  setViewMode("detail")
  // Update URL
  window.history.pushState({}, '', `?outfit=${outfit.id}`)
}

// Back to chat handler
const handleBackToChat = () => {
  setSelectedOutfit(null)
  setViewMode("chat")
  window.history.pushState({}, '', window.location.pathname)
}
```

### Buy Now Integration (Story 1.4)
```typescript
// lib/utils/product-utils.ts (existing)
export function getGenderSpecificUrl(product: Product): string {
  const isWomen = product.category?.toLowerCase() === 'women'
  return isWomen
    ? 'https://www.central.co.th/th/women'
    : 'https://www.central.co.th/th/men'
}

// Usage in ProductItemCard
<Button
  onClick={() => window.open(getGenderSpecificUrl(product), '_blank', 'noopener,noreferrer')}
>
  ซื้อเลย
</Button>
```

---

## Design Specifications

### Chat Interface Layout
```
┌─────────────────────────────┐
│ ┌──┐ OOTDay Stylist       │
│ │AI│ ที่ปรึกษาแฟชั่นของคุณ  │
├─────────────────────────────┤
│                             │
│ ┌─────────────────────────┐ │
│ │ Hello! How can OOTDay Stylist help create your perfect look?  │ │
│ └─────────────────────────┘ │
│                             │
│           ┌───────────────┐ │
│           │ Show me work  │ │
│           │ outfits       │ │
│           └───────────────┘ │
│                             │
│ ┌─────────────────────────┐ │
│ │ [Outfit Card]           │ │
│ │ View Look                   │ │
│ └─────────────────────────┘ │
├─────────────────────────────┤
│ ถามเรื่องชุดได้เลย...  [→]│
│ [ไปทำงาน] [เดท] [งาน...]  │
└─────────────────────────────┘
```

### Outfit Detail Layout
```
┌─────────────────────────────┐
│ ← Explore more outfits  │
├─────────────────────────────┤
│ ชุดทำงานสไตล์มินิมอล       │
│ งานออฟฟิศ                  │
├─────────────────────────────┤
│ ┌─────────────────────────┐ │
│ │   Outfit Preview        │ │
│ │      (3:4 ratio)        │ │
│ └─────────────────────────┘ │
├─────────────────────────────┤
│ รายการสินค้าในชุด (4 ชิ้น) │
│ ┌──┬───────────────┬─────┐ │
│ │  │ White Shirt   │ ซื้อ│ │
│ │  │ Brand Name    │ เลย │ │
│ │  │ ฿1,590       │     │ │
│ └──┴───────────────┴─────┘ │
│ [... more products ...]    │
├─────────────────────────────┤
│ ราคารวมทั้งชุด  ฿3,500    │
│ [   ซื้อทั้งชุด   ]        │ ← Sticky
└─────────────────────────────┘
```

### Styling
- Chat messages: `p-3 rounded-lg mb-3`
- User message: `bg-primary text-white ml-auto max-w-[80%]`
- AI message: `bg-gray-100 mr-auto max-w-[80%]`
- Chat input: `border rounded-lg px-4 py-2`
- Back button: `variant="ghost"` with left arrow icon
- Product card: `flex gap-3 p-3 border rounded-lg`
- Sticky section: `sticky bottom-0 bg-white border-t p-4 z-10`

---

## Implementation Notes

### File Changes
**New Files:**
- `components/chat/ChatHeader.tsx`
- `components/chat/ChatMessage.tsx`
- `components/chat/ChatInput.tsx`
- `components/chat/QuickPrompts.tsx`
- `components/chat/OutfitRecommendationCard.tsx`
- `components/outfit/OutfitProductList.tsx`
- `components/outfit/ProductItemCard.tsx`
- `components/outfit/StickyPurchaseSection.tsx`
- `components/outfit/SimilarOutfits.tsx`
- `components/ui/BackButton.tsx`

**Modified Files:**
- `components/chat/ChatAssistant.tsx` - Refactor for right panel
- `components/outfit/OutfitDetail.tsx` - Update for new layout
- `app/page.tsx` - Add viewMode state and handlers

### URL State Management
```typescript
// Read outfit ID from URL on mount
useEffect(() => {
  const params = new URLSearchParams(window.location.search)
  const outfitId = params.get('outfit')
  if (outfitId) {
    const outfit = mockOutfits.find(o => o.id === outfitId)
    if (outfit) {
      setSelectedOutfit(outfit)
      setViewMode('detail')
    }
  }
}, [])
```

### Similar Outfits Algorithm
```typescript
function getSimilarOutfits(outfit: Outfit, allOutfits: Outfit[]): Outfit[] {
  return allOutfits
    .filter(o => o.id !== outfit.id)
    .filter(o => {
      // Same occasion/style
      // Similar price range (±20%)
      const priceDiff = Math.abs(o.totalPrice - outfit.totalPrice)
      return priceDiff <= outfit.totalPrice * 0.2
    })
    .slice(0, 6)
}
```

---

## Dependencies

**Blocked By:**
- ✅ Story 2.1 Phase 1 (Foundation) - COMPLETE
- Story 2.1.2 (Middle Panel) - Outfit selection triggers detail view

**Blocks:**
- Story 2.1.5 (Interactivity) - View mode state integration

**External Dependencies:**
- Story 1.4 (Buy Now Button) - getGenderSpecificUrl utility
- Story 1.5 (Outfit Generation) - Real outfit data with products

---

## Testing Requirements

- [ ] Unit tests for viewMode state transitions
- [ ] Unit tests for URL state management
- [ ] Integration test: Outfit select → Detail view
- [ ] Integration test: Back button → Chat view
- [ ] Integration test: Buy Now opens correct URL
- [ ] Accessibility test: Keyboard navigation
- [ ] Accessibility test: Screen reader announcements
- [ ] Visual test: Chat messages render correctly
- [ ] Visual test: Outfit detail layout matches design
- [ ] Responsive test: Works on all breakpoints

---

## Success Metrics

- [ ] View mode switches smoothly without lag
- [ ] URL updates when outfit selected
- [ ] Buy Now buttons open correct gender-specific URLs
- [ ] Sticky purchase section remains visible while scrolling
- [ ] ESC key returns to chat from detail view
- [ ] Chat input focus trap works correctly
- [ ] Zero accessibility violations
- [ ] Component passes all unit tests

---

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Code reviewed and approved
- [ ] Unit tests written and passing (≥80% coverage)
- [ ] Accessibility audit passed
- [ ] Design QA approved
- [ ] Integration with Story 1.4 verified
- [ ] Documentation updated
- [ ] Merged to main branch
- [ ] Deployed to staging environment

---

**Created:** 2025-10-05
**Last Updated:** 2025-10-05
**Related:** Story 2.1, Story 2.1.2, Story 2.1.5, Story 1.4, Story 1.5
